<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hospital File Quotation</title>

  <!-- ============  STYLES (unchanged)  ============ -->
  <style>
    body{font-family:Arial,Segoe UI,sans-serif;padding:20px;max-width:700px;margin:auto;background:#f9f9f9}
    h2{text-align:center}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between}
    .field{display:flex;flex-direction:column;flex:1;min-width:100px;margin-bottom:10px}
    label{font-size:13px;margin-bottom:4px}
    input,select,button{padding:6px;border:1px solid #ccc;border-radius:4px}
    button{margin-top:15px;background:#28a745;color:#fff;font-weight:700;cursor:pointer}
    button:hover{background:#218838}
    .total{margin-top:20px;font-size:22px;font-weight:700;text-align:center;color:green}
    .box{background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,.1)}
    .steps{margin-top:20px;font-size:16px;line-height:1.6}
    .steps .step{margin-bottom:15px;display:flex;flex-direction:column}
    .steps label{font-weight:700;font-size:15px;margin-bottom:5px}
    .step-group{display:flex;gap:10px;flex-wrap:wrap;flex-direction:column}
    .gsm-select,.size-select{min-width:150px}
    .size-preview{display:flex;flex-wrap:wrap;gap:10px;margin:10px 0}
    .size-card{border:2px solid #ccc;border-radius:5px;padding:8px 10px;background:#f1f1f1;min-width:100px;
               text-align:center;font-size:12px;cursor:pointer}
    .size-card.best{border:2px solid green;background:#e6ffe6}
    .size-card.selected{border:2px solid orange;background:#fff7e6}
    .mini-box{display:inline-block;width:20px;height:20px;background:#888;margin:2px}
    .fit-count{margin-top:4px;font-size:12px}
    #boardResult,#printingResult{margin-top:15px;padding:12px;border:2px dashed #4caf50;background:#ecfff0;
                                 border-radius:6px;font-size:14px;line-height:1.5}
    .board-rate-box{margin-top:10px}
  </style>
</head>

<body>
<div class="box">
  <h2>Hospital File Quotation</h2>

  <!-- ============  TOP INPUTS  ============ -->
  <div class="row">
    <div class="field">
      <label for="unit">Unit</label>
      <select id="unit">
        <option value="inch">Inches</option>
        <option value="cm">Centimeters</option>
      </select>
    </div>
    <div class="field">
      <label for="length">Length</label>
      <input type="number" id="length" placeholder="Length" oninput="updateBoardSizes();updatePrintingSizes()">
    </div>
    <div class="field">
      <label for="width">Width</label>
      <input type="number" id="width" placeholder="Width" oninput="updateBoardSizes();updatePrintingSizes()">
    </div>
    <div class="field">
      <label for="quantity">Quantity</label>
      <input type="number" id="quantity" value="1" oninput="updateBoardSizes();updatePrintingSizes()">
    </div>
  </div>

  <!-- ============  STEPS  ============ -->
  <div class="steps">

    <!-- 1. Design -->
    <div class="step">
      <label for="design">1. Design</label>
      <input type="number" id="design" value="0">
    </div>

    <!-- 2. Board  -->
    <div class="step">
      <label>2. Board</label>
      <div class="step-group">
        <select id="boardType" onchange="updateBoardSizes()">
          <option value="">Select</option>
          <option value="Art Card">Art Card</option>
          <option value="DuplexBoard">DuplexBoard</option>
          <option value="Cyber XL">Cyber XL</option>
        </select>
        <select id="gsm" class="gsm-select">
          <option value="200">200 GSM</option><option value="250">250 GSM</option>
          <option value="300">300 GSM</option><option value="350">350 GSM</option>
          <option value="400">400 GSM</option>
        </select>
        <select id="size" class="size-select"><option value="">Select Size</option></select>
      </div>

      <div id="sizePreview" class="size-preview"></div>

      <div class="board-rate-box">
        <label for="boardRate">Board Rate Per Sheet (₹)</label>
        <input type="number" id="boardRate" value="0">
      </div>

      <div id="boardResult"></div>
    </div>

    <!-- 3. Printing -->
    <div class="step">
      <label>3. Printing</label>
      <select id="printingSize" onchange="updatePrintingQuotation()">
        <option value="19x26">19 x 26</option>
        <option value="15x20">15 x 20</option>
        <option value="18x23">18 x 23</option>
        <option value="22x28">22 x 28</option>
        <option value="13.4x19.8">13.4 x 19.8</option>
      </select>
      <div id="printingPreview" class="size-preview"></div>
      <div id="printingResult"></div>
    </div>

    <!-- 4‑7 Lamination/Die/Punch/Paste -->
    <div class="step"><label>4. Lamination</label><input id="laminationRate" type="number" value="0"></div>
    <div class="step"><label>5. Die</label><input id="die" type="number" value="0"></div>
    <div class="step"><label>6. Punching</label><input id="punching" type="number" value="0"></div>
    <div class="step"><label>7. Pasting</label><input id="pasting" type="number" value="0"></div>

  </div>

  <button onclick="calculatePrice()">Calculate Total</button>
  <div class="total" id="total">Total: ₹0.00</div>
</div>

<!-- ============  SCRIPT ============ -->
<script>
let currentBoardData = null;
let boardDataGlobal  = [];
let printingDataGlobal = [];

/*  -------  BOARD FUNCTIONS  (unchanged)  -------  */
function updateBoardSizes(){/* ... your full existing board logic here (unchanged) ... */}
function showBoardQuotation(data){/* ... unchanged ... */}

/*  =================================================
    UPDATED BLOCK 1: updatePrintingSizes()
    ================================================= */
function updatePrintingSizes(){
  const fileW = parseFloat(document.getElementById("width").value);
  const fileH = parseFloat(document.getElementById("length").value);
  if(!fileW||!fileH||!currentBoardData) return;

  const machines = ["19x26","15x20","18x23","22x28","13.4x19.8"];
  const preview  = document.getElementById("printingPreview");
  preview.innerHTML = "";

  let bestMachine = "";
  let bestUps = -1;

  printingDataGlobal = machines.map(sz=>{
    const [mW,mH] = sz.split("x").map(parseFloat);
    /* full / half / quarter board dims */
    const parts=[[currentBoardData.width,currentBoardData.height,"Full"],
                 [currentBoardData.width/2,currentBoardData.height,"Half"],
                 [currentBoardData.width,currentBoardData.height/2,"Half"],
                 [currentBoardData.width/2,currentBoardData.height/2,"Quarter"]];

    let maxFit=0, tag="";

    parts.forEach(([pw,ph,label])=>{
      /* can this board part fit on machine? */
      const fitsMachine = (pw<=mW && ph<=mH) || (ph<=mW && pw<=mH);
      if(!fitsMachine) return;
      /* how many hospital files fit in that part? */
      const fit1=Math.floor(pw/fileW)*Math.floor(ph/fileH);
      const fit2=Math.floor(pw/fileH)*Math.floor(ph/fileW);
      const ups=Math.max(fit1,fit2);
      if(ups>maxFit){maxFit=ups;tag=label;}
    });

    if(maxFit>bestUps){bestUps=maxFit;bestMachine=sz;}
    return {size:sz,ups:maxFit,label:tag};
  });

  /* draw cards */
  printingDataGlobal.forEach(d=>{
    const card=document.createElement("div");
    card.className="size-card";
    if(d.size===bestMachine) card.classList.add("best");
    card.onclick=()=>{document.getElementById("printingSize").value=d.size;updatePrintingQuotation();};
    card.innerHTML=`<strong>${d.size}</strong><br>`;
    for(let i=0;i<d.ups;i++){const dot=document.createElement("div");dot.className="mini-box";card.appendChild(dot);}
    const txt=document.createElement("div");txt.className="fit-count";
    txt.innerHTML=d.ups?`${d.ups} up (${d.label})`:"<span style='color:red;'>⚠️ Too large</span>";
    card.appendChild(txt);
    preview.appendChild(card);
  });
}

/*  =================================================
    UPDATED BLOCK 2: updatePrintingQuotation()
    ================================================= */
function updatePrintingQuotation(){
  const fileW=parseFloat(document.getElementById("width").value);
  const fileH=parseFloat(document.getElementById("length").value);
  const printingSize=document.getElementById("printingSize").value;
  if(!currentBoardData||!fileW||!fileH) return;

  const data=printingDataGlobal.find(p=>p.size===printingSize)||{ups:0,label:""};
  const qty=parseInt(document.getElementById("quantity").value)||0;
  const sheets=Math.ceil(qty/currentBoardData.fitCount);
  let base=(printingSize==="13.4x19.8")?1900:2500;
  if(sheets>3000) base+=Math.floor((sheets-1)/1000)*1000;

  const warn=data.ups?``:`<div style='color:red;font-weight:bold;'>⚠️ File size is too large for this machine!</div>`;

  document.getElementById("printingResult").innerHTML=`<strong>Printing Quotation:</strong><br>
    Machine Size: <b>${printingSize}</b><br>
    Fit: <b>${data.ups?data.ups+" up ("+data.label+")":"N/A"}</b><br>
    Sheets: <b>${sheets}</b><br>
    Printing Cost: ₹<b>${base}</b><br>${warn}`;
}

/*  -------  TOTAL CALC (unchanged)  -------  */
function calculatePrice(){/* ... unchanged ... */}

/*  Event hooks same as before  */
document.getElementById("boardRate").addEventListener("input",()=>{if(currentBoardData)showBoardQuotation(currentBoardData);});
document.getElementById("printingSize").addEventListener("change",updatePrintingQuotation);
</script>
</body>
</html>
