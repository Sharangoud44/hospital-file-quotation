<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hospital File Quotation</title>
  <style>
    /* ‚Äî‚Äî‚Äî CSS (unchanged) ‚Äî‚Äî‚Äî */
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 700px;
      margin: auto;
      background-color: #f9f9f9;
    }
    h2 { text-align: center; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; justify-content: space-between; }
    .field { display: flex; flex-direction: column; flex: 1; min-width: 100px; margin-bottom: 10px; }
    label { font-size: 13px; margin-bottom: 4px; }
    input, select, button {
      padding: 6px; border: 1px solid #ccc; border-radius: 4px;
    }
    button {
      margin-top: 15px; background-color: #28a745; color: #fff;
      font-weight: bold; cursor: pointer;
    }
    button:hover { background-color: #218838; }
    .total    { margin-top: 20px; font-size: 22px; font-weight: bold; text-align: center; color: green; }
    .box      { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,.1); }
    .steps    { margin-top: 20px; font-size: 16px; line-height: 1.6; }
    .steps .step { margin-bottom: 15px; display: flex; flex-direction: column; }
    .steps label { font-weight: bold; font-size: 15px; margin-bottom: 5px; }
    .step-group { display: flex; gap: 10px; flex-wrap: wrap; align-items: flex-start; flex-direction: column; }
    .gsm-select,.size-select { min-width: 150px; }
    .size-preview { display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
    .size-card {
      border: 2px solid #ccc; border-radius: 5px; padding: 8px 10px;
      background: #f1f1f1; min-width: 100px; text-align: center; font-size: 12px;
      position: relative; cursor: pointer;
    }
    .size-card.best      { border: 2px solid green;  background: #e6ffe6; }
    .size-card.selected  { border: 2px solid orange; background: #fff7e6; }
    .mini-box   { display: inline-block; width: 20px; height: 20px; background: #888; margin: 2px; }
    .fit-count  { margin-top: 4px; font-size: 12px; }
    #boardResult,#printingResult {
      margin-top: 15px; padding: 12px; border: 2px dashed #4caf50;
      background: #ecfff0; border-radius: 6px; font-size: 14px; line-height: 1.5;
    }
    .board-rate-box { margin-top: 10px; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Hospital File Quotation</h2>

    <!-- ‚Äî‚Äî‚Äî INPUT FIELDS (unchanged) ‚Äî‚Äî‚Äî -->
    <div class="row">
      <div class="field">
        <label for="unit">Unit</label>
        <select id="unit">
          <option value="inch">Inches</option>
          <option value="cm">Centimeters</option>
        </select>
      </div>
      <div class="field">
        <label for="length">Length</label>
        <input type="number" id="length" placeholder="Length" oninput="updateBoardSizes()">
      </div>
      <div class="field">
        <label for="width">Width</label>
        <input type="number" id="width" placeholder="Width" oninput="updateBoardSizes()">
      </div>
      <div class="field">
        <label for="quantity">Quantity</label>
        <input type="number" id="quantity" value="1" oninput="updateBoardSizes()">
      </div>
    </div>

    <div class="steps">
      <div class="step">
        <label for="design">1. Design</label>
        <input type="number" id="design" value="0">
      </div>

      <div class="step">
        <label>2. Board</label>
        <div class="step-group">
          <select id="boardType" onchange="updateBoardSizes()">
            <option value="">Select</option>
            <option value="Art Card">Art Card</option>
            <option value="DuplexBoard">DuplexBoard</option>
            <option value="Cyber XL">Cyber XL</option>
          </select>
          <select id="gsm" class="gsm-select">
            <option value="200">200‚ÄØGSM</option><option value="250">250‚ÄØGSM</option>
            <option value="300">300‚ÄØGSM</option><option value="350">350‚ÄØGSM</option>
            <option value="400">400‚ÄØGSM</option>
          </select>
          <select id="size" class="size-select"><option value="">Select Size</option></select>
        </div>

        <div id="sizePreview" class="size-preview"></div>

        <div class="board-rate-box">
          <label for="boardRate">Board Rate Per Sheet (‚Çπ)</label>
          <input type="number" id="boardRate" value="0">
        </div>

        <div id="boardResult"></div>
      </div>

      <div class="step">
        <label>3. Printing</label>
        <select id="printingSize">
          <option value="19x26">19‚ÄØx‚ÄØ26</option>
          <option value="15x20">15‚ÄØx‚ÄØ20</option>
          <option value="18x23">18‚ÄØx‚ÄØ23</option>
          <option value="22x28">22‚ÄØx‚ÄØ28</option>
          <option value="13.4x19.8">13.4‚ÄØx‚ÄØ19.8 (Small)</option>
        </select>
        <div id="printingResult"></div>
      </div>

      <div class="step"><label for="laminationRate">4. Lamination</label><input id="laminationRate" type="number" value="0"></div>
      <div class="step"><label for="die">5. Die</label><input id="die" type="number" value="0"></div>
      <div class="step"><label for="punching">6. Punching</label><input id="punching" type="number" value="0"></div>
      <div class="step"><label for="pasting">7. Pasting</label><input id="pasting" type="number" value="0"></div>
    </div>

    <button onclick="calculatePrice()">Calculate Total</button>
    <div class="total" id="total">Total: ‚Çπ0.00</div>
  </div>

<!-- ‚Äî‚Äî‚Äî SCRIPT ‚Äî‚Äî‚Äî -->
<script>
let boardDataGlobal = [];
let bestSizeGlobal  = "";
let currentBoardData = null;   // keeps latest chosen board config

function updateBoardSizes() {
  const boardType   = document.getElementById("boardType").value;
  const sizePreview = document.getElementById("sizePreview");
  sizePreview.innerHTML = "";

  const fileW   = parseFloat(document.getElementById("width").value);
  const fileH   = parseFloat(document.getElementById("length").value);
  const quantity= parseInt(document.getElementById("quantity").value);
  if (!fileW || !fileH || !quantity) return;

  const sizes = boardType==="Art Card"
      ? ["30 X 40","23 X 36","25 X 36","22 X 28"]
      : boardType==="Cyber XL"
      ? ["22 X 28","23 X 30","23 X 36","25 X 36","20 X 30","31.5 X 41.5","25 X 30"]
      : [];

  const sizeDropdown = document.getElementById("size");
  sizeDropdown.innerHTML = '<option value="">Select Size</option>';
  sizes.forEach(s=> sizeDropdown.innerHTML+=`<option value="${s}">${s}</option>`);

  let bestWastage = Infinity;
  boardDataGlobal = sizes.map(size=>{
      const [h,w] = size.split(" X ").map(parseFloat);
      const fit1  = Math.floor(w/fileW)*Math.floor(h/fileH);
      const fit2  = Math.floor(w/fileH)*Math.floor(h/fileW);
      const fit   = Math.max(fit1,fit2);
      const waste = w*h - fit*fileW*fileH;
      if (waste<bestWastage && fit>0){ bestWastage=waste; bestSizeGlobal=size;}
      return {size,width:w,height:h,fitCount:fit,waste};
  });

  boardDataGlobal.forEach(d=>{
    const card=document.createElement("div");
    card.className="size-card"+(d.size===bestSizeGlobal?" best":"");
    card.onclick=()=>showBoardQuotation(d);
    card.innerHTML=`<strong>${d.size}</strong><br>`;
    for(let i=0;i<d.fitCount;i++){const box=document.createElement("div");box.className="mini-box";card.appendChild(box);}
    const txt=document.createElement("div");txt.className="fit-count";
    txt.innerHTML=`${d.fitCount} file(s) fit<br>Wastage: ${d.waste.toFixed(2)} in¬≤`+(d.size===bestSizeGlobal?" ‚úÖ Best Fit":"");
    card.appendChild(txt);
    sizePreview.appendChild(card);
  });

  const best=boardDataGlobal.find(d=>d.size===bestSizeGlobal);
  if(best) showBoardQuotation(best);
}

function showBoardQuotation(data){
  currentBoardData=data;
  const quantity  = parseInt(document.getElementById("quantity").value);
  const boardRate = parseFloat(document.getElementById("boardRate").value)||0;
  const sheets    = Math.ceil(quantity / data.fitCount);
  const boardCost = sheets * boardRate;

  document.getElementById("boardResult").innerHTML=
    `<strong>Board Quotation:</strong><br>
      Selected Size: <b>${data.size}</b><br>
      Files per Sheet: <b>${data.fitCount}</b><br>
      Quantity Required: <b>${quantity}</b><br>
      Total Sheets Needed: <b>${sheets}</b><br>
      <strong>Board Cost: ‚Çπ${boardCost.toFixed(2)}</strong>`;

  document.querySelectorAll(".size-card").forEach(c=>{
      c.classList.toggle("selected",c.innerText.includes(data.size));
  });

  // ‚Äî‚Äî Printing quotation ‚Äî‚Äî
  const printingSize = document.getElementById("printingSize").value;
  let basePrice = printingSize==="13.4x19.8" ? 1900 : 2500;
  if(sheets>3000) basePrice += Math.floor((sheets-1)/1000)*1000;

  // üî¥ NEW: warn if file bigger than machine
  const fileW=parseFloat(document.getElementById("width").value);
  const fileH=parseFloat(document.getElementById("length").value);
  const [mW,mH]=printingSize.split("x").map(parseFloat);
  const isTooSmall = (fileW>mW || fileH>mH);
  const warningText = isTooSmall
      ? `<div style="color:red;font-weight:bold;">‚ö†Ô∏è File size is too large for this machine!</div>`
      : "";

  document.getElementById("printingResult").innerHTML=
    `<strong>Printing Quotation:</strong><br>
      Machine Size: <b>${printingSize}</b><br>
      Sheets: <b>${sheets}</b><br>
      Printing Cost: ‚Çπ<b>${basePrice}</b><br>
      ${warningText}`;
}

function calculatePrice(){
  const design   = parseFloat(document.getElementById("design").value)||0;
  const lam      = parseFloat(document.getElementById("laminationRate").value)||0;
  const die      = parseFloat(document.getElementById("die").value)||0;
  const punch    = parseFloat(document.getElementById("punching").value)||0;
  const paste    = parseFloat(document.getElementById("pasting").value)||0;

  const boardMatch    = document.getElementById("boardResult").innerText.match(/Board Cost: ‚Çπ(\d+(\.\d+)?)/);
  const printMatch    = document.getElementById("printingResult").innerText.match(/Printing Cost: ‚Çπ(\d+(\.\d+)?)/);
  const board = boardMatch ? parseFloat(boardMatch[1]) : 0;
  const print = printMatch ? parseFloat(printMatch[1]) : 0;

  const total = design+board+print+lam+die+punch+paste;
  document.getElementById("total").textContent=`Total: ‚Çπ${total.toFixed(2)}`;
}

/* ‚Äî‚Äî live updates ‚Äî‚Äî */
document.getElementById("boardRate"   ).addEventListener("input" ,()=>{ if(currentBoardData) showBoardQuotation(currentBoardData); });
document.getElementById("printingSize").addEventListener("change",()=>{ if(currentBoardData) showBoardQuotation(currentBoardData); });
</script>
</body>
</html>
