<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hospital File Quotation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 700px;
      margin: auto;
      background-color: #f9f9f9;
    }
    h2 {
      text-align: center;
    }
    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: space-between;
    }
    .field {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 100px;
      margin-bottom: 10px;
    }
    label {
      font-size: 13px;
      margin-bottom: 4px;
    }
    input, select, button {
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      margin-top: 15px;
      background-color: #28a745;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
    .total {
      margin-top: 20px;
      font-size: 22px;
      font-weight: bold;
      text-align: center;
      color: green;
    }
    .box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .steps {
      margin-top: 20px;
      font-size: 16px;
      line-height: 1.6;
    }
    .steps .step {
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
    }
    .steps label {
      font-weight: bold;
      font-size: 15px;
      margin-bottom: 5px;
    }
    .step-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: flex-start;
      flex-direction: column;
    }
    .gsm-select, .size-select {
      min-width: 150px;
    }
    .size-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px 0;
    }
    .size-card {
      border: 2px solid #ccc;
      border-radius: 5px;
      padding: 8px 10px;
      background: #f1f1f1;
      min-width: 100px;
      text-align: center;
      font-size: 12px;
      position: relative;
      cursor: pointer;
    }
    .size-card.best {
      border: 2px solid green;
      background-color: #e6ffe6;
    }
    .size-card.selected {
      border: 2px solid orange;
      background-color: #fff7e6;
    }
    .mini-box {
      display: inline-block;
      width: 20px;
      height: 20px;
      background-color: #888;
      margin: 2px;
    }
    .fit-count {
      margin-top: 4px;
      font-size: 12px;
    }
    #boardResult, #printingResult {
      margin-top: 15px;
      padding: 12px;
      border: 2px dashed #4caf50;
      background: #ecfff0;
      border-radius: 6px;
      font-size: 14px;
      line-height: 1.5;
    }
    .board-rate-box {
      margin-top: 10px;
    }
  </style>
</head>
<body>
<!-- Skipping previous HTML content for brevity -->
<script>
function updatePrintingSizes() {
  const fileW = parseFloat(document.getElementById("width").value);
  const fileH = parseFloat(document.getElementById("length").value);
  const quantity = parseInt(document.getElementById("quantity").value);
  if (!fileW || !fileH || !currentBoardData) return;

  const boardW = currentBoardData.width;
  const boardH = currentBoardData.height;

  const sizes = ["19x26", "15x20", "18x23", "22x28", "13.4x19.8"];
  const preview = document.getElementById("printingPreview");
  preview.innerHTML = "";

  let bestFit = null;
  let maxFitCount = -1;

  printingDataGlobal = sizes.map(size => {
    const [mW, mH] = size.split("x").map(parseFloat);
    const splitOptions = [
      { label: "Full", w: boardW, h: boardH },
      { label: "Half", w: boardW / 2, h: boardH },
      { label: "Half", w: boardW, h: boardH / 2 },
      { label: "Quarter", w: boardW / 2, h: boardH / 2 },
    ];

    let fitCount = 0;
    let chosenSplit = null;
    for (let opt of splitOptions) {
      const fitsNormal = opt.w <= mW && opt.h <= mH;
      const fitsRotated = opt.h <= mW && opt.w <= mH;
      if ((fitsNormal || fitsRotated) && fileW <= opt.w && fileH <= opt.h) {
        const fit1 = Math.floor(opt.w / fileW) * Math.floor(opt.h / fileH);
        const fit2 = Math.floor(opt.w / fileH) * Math.floor(opt.h / fileW);
        const count = Math.max(fit1, fit2);
        if (count > fitCount) {
          fitCount = count;
          chosenSplit = opt.label;
        }
      }
    }

    if (fitCount > maxFitCount) {
      bestFit = size;
      maxFitCount = fitCount;
    }

    return { size, fitCount, chosenSplit };
  });

  printingDataGlobal.forEach(data => {
    const card = document.createElement("div");
    card.className = "size-card";
    if (data.size === bestFit) card.classList.add("best");

    card.onclick = () => {
      document.getElementById("printingSize").value = data.size;
      updatePrintingQuotation();
    };

    card.innerHTML = `<strong>${data.size}</strong><br>`;
    for (let i = 0; i < data.fitCount; i++) {
      const dot = document.createElement("div");
      dot.className = "mini-box";
      card.appendChild(dot);
    }
    const text = document.createElement("div");
    text.className = "fit-count";
    text.innerHTML = data.fitCount > 0
      ? `${data.fitCount} fit - ${data.chosenSplit} ✅` + (data.size === bestFit ? " <b>Best</b>" : "")
      : `<span style='color:red;'>⚠️ Too large</span>`;
    card.appendChild(text);
    preview.appendChild(card);
  });
}

function updatePrintingQuotation() {
  const printingSize = document.getElementById("printingSize").value;
  const quantity = parseInt(document.getElementById("quantity").value);
  if (!currentBoardData || !quantity || !printingSize) return;

  const sheets = Math.ceil(quantity / currentBoardData.fitCount);
  let basePrice = (printingSize === "13.4x19.8") ? 1900 : 2500;
  if (sheets > 3000) basePrice += Math.floor((sheets - 1) / 1000) * 1000;

  const data = printingDataGlobal.find(p => p.size === printingSize);
  const warningText = !data || data.fitCount === 0
    ? `<div style='color:red;font-weight:bold;'>⚠️ File size is too large for this machine!</div>`
    : "";

  document.getElementById("printingResult").innerHTML = `<strong>Printing Quotation:</strong><br>
    Machine Size: <b>${printingSize}</b><br>
    Sheets: <b>${sheets}</b><br>
    Printing Cost: ₹<b>${basePrice}</b><br>${warningText}`;
}
</script>
</body>
</html>
